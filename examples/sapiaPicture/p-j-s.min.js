require=function r(e,t,n){function o(i,s){if(!t[i]){if(!e[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var p=t[i]={exports:{}};e[i][0].call(p.exports,function(r){var t=e[i][1][r];return o(t?t:r)},p,p.exports,r,e,t,n)}return t[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(r,e){var t=arguments[3],n=arguments[4],o=arguments[5],a=JSON.stringify;e.exports=function(r){for(var e,i=Object.keys(o),s=0,u=i.length;u>s;s++){var c=i[s];if(o[c].exports===r){e=c;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var p={},s=0,u=i.length;u>s;s++){var c=i[s];p[c]=c}n[e]=[Function(["require","module","exports"],"("+r+")(self)"),p]}var d=Math.floor(Math.pow(16,8)*Math.random()).toString(16),f={};f[e]=e,n[d]=[Function(["require"],"require("+a(e)+")(self)"),f];var l="("+t+")({"+Object.keys(n).map(function(r){return a(r)+":["+n[r][0]+","+a(n[r][1])+"]"}).join(",")+"},{},["+a(d)+"])",h=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(h.createObjectURL(new Blob([l],{type:"text/javascript"})))}},{}],2:[function(r,e){function t(){for(var r={},e=0;e<arguments.length;e++){var t=arguments[e];for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n])}return r}e.exports=t},{}],3:[function(r,e){function t(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n])}return r}e.exports=t},{}],4:[function(r,e){function t(r,e){r.__verifyPreviousOperation();var t=r.depth+1,n=p.extendChainContext(t,e.localContext,r.chainContext),o=s(e.operation,e.f,e.seed,e.identity,e.identityReducer),a={source:r.source,parts:r.parts,operation:o,globalContext:r.globalContext,chainContext:n,previousOperations:r.operations,depth:t};return new l(a)}var n=r("./job_packager"),o=r("./workers"),a=r("./typed_array_merger"),i=r("./operation_names"),s=r("./operation_packager"),u=r("./errors"),c=r("./utils"),p=r("./chain_context"),d=r("xtend/immutable"),f={map:function(r,e,t,n){t?t(null,e):n(e)},filter:function(r,e,t,n){t?t(null,e):n(e)},reduce:function(r,e,t,n){for(var o=d(r.globalContext,r.__localContext()),a=r.operation,i=a.identityCode,s=a.seed,u=0,c=e.length;c>u;u++)s=i(s,e[u],o);t?t(null,s):n(s)}},l=function(r){this.packager=new n(r.parts,r.source),this.source=r.source,this.parts=r.parts,this.operation=r.operation,this.globalContext=r.globalContext,this.chainContext=r.chainContext;var e=r.previousOperations||[];e.push(r.operation),this.operations=e,this.depth=r.depth||0};l.prototype.__localContext=function(){return p.contextFromChainContext(this.depth,this.chainContext)},l.prototype.map=function(r,e){return t(this,{localContext:e,f:r,operation:i.MAP})},l.prototype.filter=function(r,e){return t(this,{localContext:e,f:r,operation:i.FILTER})},l.prototype.reduce=function(r,e,n,o,a){return c.isFunction(n)||(a=o,o=n,n=r),t(this,{localContext:a,f:r,seed:e,identity:o,identityReducer:n,operation:i.REDUCE})},l.prototype.seq=function(r){var e=this;return new Promise(function(t,n){var i=e.packager.generatePackages(e.operations,e.chainContext);o.sendPacks(i,function(o,s){if(o)return r?r(o):n(o),void 0;var u=s.map(function(r){var e=i[0].elementsType.replace("Shared",""),t=r.start,n=r.newEnd,o=c.createTypedArray(e,r.value);return o.subarray(t,n)}),p=a(u);return f[e.operation.name](e,p,r,t)})})},l.prototype.__verifyPreviousOperation=function(){if("reduce"===this.operation.name)throw new u.InvalidOperationError(u.messages.INVALID_CHAINING_OPERATION)},e.exports=l},{"./chain_context":5,"./errors":8,"./job_packager":9,"./operation_names":10,"./operation_packager":11,"./typed_array_merger":13,"./utils":15,"./workers":18,"xtend/immutable":2}],5:[function(r,e){var t=r("./context"),n=r("xtend"),o=e.exports={};o.serializeChainContext=function(r){return JSON.stringify(r)},o.deserializeChainContext=function(r){return JSON.parse(r)},o.extendChainContext=function(r,e,o){if(!e&&!o)return void 0;if(!e)return n(o,void 0);var a={};return a[r]=t.serializeFunctions(e),o?n(o,a):a},o.contextFromChainContext=function(r,e){return e&&e[r]?t.deserializeFunctions(e[r]):void 0}},{"./context":6,xtend:2}],6:[function(r,e){function t(r){var e=o.parseFunction(r);return{__isFunction:!0,args:e.args,code:e.body}}function n(r){return o.createFunction(r.args,r.code)}var o=r("./utils"),a={};e.exports=a,a.deserializeFunctions=function(r){return Object.keys(r).reduce(function(e,t){var i=r[t];return o.isObject(i)&&(i.__isFunction?e[t]=n(i):a.deserializeFunctions(i)),e},r)},a.serializeFunctions=function(r){var e;return r&&(e=Object.keys(r).reduce(function(e,n){var i=r[n];return e[n]=o.isFunction(i)?t(i):o.isObject(i)?a.serializeFunctions(i):i,e},{})),e}},{"./utils":15}],7:[function(r,e){var t=r("./errors"),n=r("./context"),o=e.exports=function(r){if(!r)throw new t.InvalidArgumentsError(t.messages.INVALID_PARTS);this.parts=r};o.prototype.generatePackages=function(r){if(!r)throw new t.InvalidArgumentsError(t.messages.INVALID_CONTEXT);for(var e=new Array(this.parts),o=0;o<this.parts;o++)e[o]={index:o,contextUpdate:JSON.stringify(n.serializeFunctions(r))};return e}},{"./context":6,"./errors":8}],8:[function(r,e){var t=e.exports={},n=function(r){this.name="InvalidOperationError",this.message=r||"Invalid Operation"};n.prototype=new Error,n.prototype.constructor=n,t.InvalidOperationError=n;var o=function(r){this.name="InvalidArgumentsError",this.message=r||"Invalid Arguments"};o.prototype=new Error,o.prototype.constructor=o,t.InvalidArgumentsError=o;var a=function(r){this.name="WorkerError",this.message=r||"An unknown error ocurred in the worker"};a.prototype=new Error,a.prototype.constructor=a,t.WorkerError=a,t.messages={CONSECUTIVE_INITS:"You should not recall init if the library is already initialized.",TERMINATE_WITHOUT_INIT:"You should not terminate pjs if it was not initialized before.",PARTITIONER_ARGUMENT_IS_NOT_TYPED_ARRAY:"Expected TypedArray argument.",ZERO_ARRAYS_TO_MERGE:"Zero arrays to merge. Provide at least one.",INVALID_PARTS:"Invalid number of parts.",INVALID_CONTEXT:"Invalid context.",PART_ALREADY_COLLECTED:"Tried to collect part {0} more than once",MISSING_CODE_OR_PATH:'Missing "code" or "functionPath" argument to package.',INVALID_IDENTITY_CODE:"Invalid identity code argument to package.",INVALID_ELEMENTS:"Invalid number of elements to package.",INVALID_PACKAGE_INDEX:"Package index should be not negative and less than {0}.",INVALID_TYPED_ARRAY:"Invalid argument. It should be of TypedArray.",INVALID_OPERATION:"Invalid pjs operation. Possible values are 'filter', 'map' or 'reduce'.",INVALID_OPERATIONS:"Invalid operation chain sent to JobPackager. Either undefined or empty.",MISSING_SEED:"Missing Seed argument for reduce operation packaging.",MISSING_IDENTITY:"Missing Identity argument for reduce operation packaging.",INVALID_CHAINING_OPERATION:"Can not perform more chaining after reduce operation."}},{}],9:[function(r,e){var t=r("./errors"),n=r("./utils"),o=r("./typed_array_partitioner"),a=r("./chain_context"),i=r("./operation_names");i=Object.keys(i).map(function(r){return i[r]});var s=e.exports=function(r,e){if(!r)throw new t.InvalidArgumentsError(t.messages.INVALID_PARTS);if(!e)throw new t.InvalidArgumentsError(t.messages.INVALID_ELEMENTS);this.parts=r,this.elements=e};s.prototype.generatePackages=function(r,e){if(!r||!r.length)throw new t.InvalidArgumentsError(t.messages.INVALID_OPERATIONS);var s=r.map(function(r){if(!r.code&&!r.functionPath)throw new t.InvalidArgumentsError(t.messages.MISSING_CODE_OR_PATH);if(!r.name||-1===i.indexOf(r.name))throw new t.InvalidArgumentsError(t.messages.INVALID_OPERATION);if(!r.functionPath){var e=n.parseFunction(r.code.toString());return{identity:r.identity,args:e.args,code:e.body,name:r.name}}return{identity:r.identity,name:r.name,functionPath:r.functionPath}}),u=n.getTypedArrayType(this.elements),c=new o(this.parts),p=c.partition(this.elements),d=n.isSharedArray(this.elements),f=a.serializeChainContext(e);return p.map(function(r,e){var t,n,o;return d?(t=r.sharedArray.buffer,n=r.from,o=r.to):(t=r.buffer,n=0,o=r.length),{index:e,start:n,end:o,buffer:t,operations:s,elementsType:u,ctx:f}})}},{"./chain_context":5,"./errors":8,"./operation_names":10,"./typed_array_partitioner":14,"./utils":15}],10:[function(r,e){e.exports={MAP:"map",FILTER:"filter",REDUCE:"reduce"}},{}],11:[function(r,e){var t=r("./errors"),n=r("./utils"),o=r("./operation_names");o=Object.keys(o).map(function(r){return o[r]}),e.exports=function(r,e,a,i,s){if(!r||-1===o.indexOf(r))throw new t.InvalidArgumentsError(t.messages.INVALID_OPERATION);if(!e)throw new t.InvalidArgumentsError(t.messages.INVALID_CODE);if("reduce"===r&&"undefined"==typeof s)throw new t.InvalidArgumentsError(t.messages.INVALID_IDENTITY_CODE);if("reduce"===r&&"undefined"==typeof a)throw new t.InvalidArgumentsError(t.messages.MISSING_SEED);if("reduce"===r&&"undefined"==typeof i)throw new t.InvalidArgumentsError(t.messages.MISSING_IDENTITY);var u={name:r,seed:a,identity:i,identityCode:s},c=n.isFunction(e)?"code":"functionPath";return u[c]=e,u}},{"./errors":8,"./operation_names":10,"./utils":15}],12:[function(r,e){var t=r("./errors.js"),n=r("./utils.js"),o=e.exports=function(r,e){if(!r)throw new t.InvalidArgumentsError(t.messages.INVALID_PARTS);if(!e)throw new t.InvalidArgumentsError(t.messages.MISSING_CALLBACK);this.cb=e,this.parts=r,this.collected=new Array(r),this.completed=0,this.error=null};o.prototype.onError=function(r){this.error||(this.error=new t.WorkerError(r)),this.updateCompleted()},o.prototype.onPart=function(r){if(this.error)return this.updateCompleted();if(this.collected[r.index])throw new t.InvalidArgumentsError(n.format(t.messages.PART_ALREADY_COLLECTED,r.index));this.collected[r.index]={value:r.value,start:r.start,newEnd:r.newEnd},this.updateCompleted()},o.prototype.updateCompleted=function(){return++this.completed===this.parts?this.error?this.cb(this.error):this.cb(null,this.collected):void 0}},{"./errors.js":8,"./utils.js":15}],13:[function(r,e){var t=r("./errors.js");e.exports=function(r){if(!r.length)throw new t.InvalidArgumentsError(t.messages.ZERO_ARRAYS_TO_MERGE);var e=r[0];if(1===r.length)return e;for(var n=r.reduce(function(r,e){return r+e.length},0),o=new e.constructor(n),a=0,i=0;i<r.length;i++){var s=r[i];o.set(s,a),a+=s.length}return o}},{"./errors.js":8}],14:[function(r,e){var t=r("./utils.js"),n=r("./errors.js"),o=function(r,e,t){var n=r.subarray(e,t);return new r.constructor(n)},a=e.exports=function(r){if(!r)throw new n.InvalidArgumentsError(n.messages.INVALID_PARTS);this.parts=r};a.prototype.constructor=a,a.prototype.partition=function(r){return this.__validateTypedArray(r),this.__doPartition(r,this)},a.prototype.__validateTypedArray=function(r){if(!t.isTypedArray(r)){var e=t.format("Invalid type {0}. {1}",r,n.messages.PARTITIONER_ARGUMENT_IS_NOT_TYPED_ARRAY);throw new n.InvalidArgumentsError(e)}},a.prototype.__doPartition=function(r){var e,n=this.parts,a=r.length,i=0|Math.floor(a/n),s=0,u=0,c=t.isSharedArray(r),p=new Array(n);c&&(e=t.duplicateTypedArray(r));for(var d=0;n>d;d++)n-1===d?u=a:u+=i,p[d]=c?{from:s,to:u,sharedArray:e}:o(r,s,u),s+=i;return p}},{"./errors.js":8,"./utils.js":15}],15:[function(r,e){function t(r,e){var t=new Array(r);return t.push(e),Function.prototype.constructor.apply(null,t)}var n=e.exports={},o=/^function[^(]*\(([^)]*)\)[^{]*\{([\s\S]*)\}$/;n.parseFunction=function(r){var e=r.toString(),t=e.match(o),n=t[1].split(",").map(function(r){return r.trim()}),a=t[2];return{args:n,body:a}},n.isObject=function(r){return"object"==typeof r&&!Array.isArray(r)},n.isFunction=function(r){return!!(r&&r.constructor&&r.call&&r.apply)},n.duplicateTypedArray=function(r){var e=this.getTypedArrayType(r),t=this.createTypedArray(e,r.length);return t.set(r),this.createTypedArray(e,t.buffer)},n.createTypedArray=function(r,e){switch(r){case"SharedUint8Array":return new SharedUint8Array(e);case"SharedUint8ClampedArray":return new SharedUint8ClampedArray(e);case"SharedUint16Array":return new SharedUint16Array(e);case"SharedUint32Array":return new SharedUint32Array(e);case"SharedInt8Array":return new SharedInt8Array(e);case"SharedInt16Array":return new SharedInt16Array(e);case"SharedInt32Array":return new SharedInt32Array(e);case"SharedFloat32Array":return new SharedFloat32Array(e);case"SharedFloat64Array":return new SharedFloat64Array(e);case"Uint8Array":return new Uint8Array(e);case"Uint8ClampedArray":return new Uint8ClampedArray(e);case"Uint16Array":return new Uint16Array(e);case"Uint32Array":return new Uint32Array(e);case"Int8Array":return new Int8Array(e);case"Int16Array":return new Int16Array(e);case"Int32Array":return new Int32Array(e);case"Float32Array":return new Float32Array(e);case"Float64Array":return new Float64Array(e)}},n.getter=function(r,e,t){Object.defineProperty(r,e,{enumerable:!0,configurable:!0,get:function(){return t}})},n.isTypedArray=function(r){if(!r)return!1;var e=n.getTypedArrayType(r);switch(e){case"SharedUint32Array":case"Uint8Array":case"Int8Array":case"Uint8ClampedArray":case"Uint16Array":case"Int16Array":case"Uint32Array":case"Int32Array":case"Float32Array":case"Float64Array":return!0;default:return!1}},n.isSharedArray=function(r){return r?"SharedUint32Array"===n.getTypedArrayType(r):!1},n.getTypedArrayConstructorType=function(r){var e=r.toString();return e.substring("function ".length,e.length-"() { [native code] }".length)},n.getTypedArrayType=function(r){var e=r.toString();return e.substring("[object ".length,e.length-1)},n.format=function(r){for(var e=Array.prototype.slice.call(arguments,1),t=r,n=0;n<e.length;n++)t=t.replace("{"+n+"}",e[n]);return t},n.createFunction=function(r,e){switch(r.length){case 0:return new Function(e);case 1:return new Function(r[0],e);case 2:return new Function(r[0],r[1],e);case 3:return new Function(r[0],r[1],r[2],e);case 4:return new Function(r[0],r[1],r[2],r[3],e);default:return t(r,e)}};var a=function(r,e,t,o){var i=r[e[t]];return e.length-1===t?i:(n.isObject(i)||o(),a(i,e,++t))};n.getNested=function(r,e){var t=e.split(".");return a(r,t,0,function(){throw new Error(n.format("Cannot get nested path {0} from context",e))})}},{}],16:[function(r,e){var t=r("./worker_core");e.exports=function(r){r.addEventListener("message",function(e){var n=t(e);r.postMessage(n.message,n.transferables)})}},{"./worker_core":17}],17:[function(r,e){function t(){return"function"==typeof Map?function(){return new Map}:function(){return Object.create(null)}}function n(r){if(r.functionPath)return i.getNested(f,r.functionPath);var e=r.args,t=r.code,n=e.join(",")+t,o=d[n];return o||(o=i.createFunction(e,t),d[n]=o),o}function o(r,e){var t;if(e){e=c.deserializeChainContext(e),t={};for(var n=0;r>=n;n++)e[n]&&(t[n]=u.deserializeFunctions(e[n]))}return t}var a=r("xtend/mutable"),i=r("./utils"),s=r("xtend/immutable"),u=r("./context"),c=r("./chain_context"),p=t(),d=p(),f={},l={map:function(r,e,t,n,o){for(var a=e;t>a;a+=1)r[a]=n(r[a],o);return t},filter:function(r,e,t,n,o){for(var a=e,i=e;t>a;a+=1){var s=r[a];n(s,o)&&(r[i++]=s)}return i},reduce:function(r,e,t,n,o,a){for(var i=e,s=a;t>i;i+=1){var u=r[i];s=n(s,u,o)}return r[0]=s,1}};e.exports=function(r){var e=r.data;if(e.contextUpdate){var t=u.deserializeFunctions(JSON.parse(e.contextUpdate));return a(f,t),{message:{index:e.index}}}for(var c=e.operations,p=c.length,d=o(p,e.ctx),h=i.createTypedArray(e.elementsType.replace("Shared",""),e.buffer),y=e.start,g=e.end,m=0;p>m;m+=1){var A,v=c[m],I=v.identity,_=n(v);A=d?s(f,d[m]):f,g=l[v.name](h,y,g,_,A,I)}return{message:{index:e.index,value:h.buffer,start:y,newEnd:g},transferables:[h.buffer]}}},{"./chain_context":5,"./context":6,"./utils":15,"xtend/immutable":2,"xtend/mutable":3}],18:[function(r,e){function t(){o||(o=u.shift(),o&&n())}function n(){var r=o.callback,e=o.packs,n=new a(s.length,function(e,n){o=void 0,r(e,n),t()});e.forEach(function(r,e){var t=function(r){return r.target.removeEventListener("error",o),r.target.removeEventListener("message",t),n.onPart(r.data)},o=function(r){return r.preventDefault(),r.target.removeEventListener("error",o),r.target.removeEventListener("message",t),n.onError(r.message)};s[e].addEventListener("error",o),s[e].addEventListener("message",t),r.buffer?s[e].postMessage(r,[r.buffer]):s[e].postMessage(r)})}var o,a=r("./result_collector"),i=r("webworkify"),s=[],u=[];Object.defineProperty(e.exports,"length",{get:function(){return s.length}}),e.exports.init=function(e){for(;e--;){var t=i(r("./worker.js"));s.push(t)}},e.exports.terminate=function(){s.forEach(function(r){r.terminate()}),s=[]},e.exports.sendPacks=function(r,e){u.push({packs:r,callback:e}),t()}},{"./result_collector":12,"./worker.js":16,webworkify:1}],19:[function(r,e){var t=r("./operation_names"),n=r("./chain"),o=r("./operation_packager"),a=r("./chain_context"),i=r("./utils"),s=function(r,e,t){this.source=r,this.parts=e,this.globalContext=t};s.prototype.map=function(r,e){return this.__operation(t.MAP,r,e)},s.prototype.filter=function(r,e){return this.__operation(t.FILTER,r,e)},s.prototype.reduce=function(r,e,n,o,a){return i.isFunction(n)||(a=o,o=n,n=r),this.__operation(t.REDUCE,r,a,e,o,n)},s.prototype.__operation=function(r,e,t,i,s,u){var c=o(r,e,i,s,u),p=a.extendChainContext(0,t),d={source:this.source,parts:this.parts,operation:c,globalContext:this.globalContext,chainContext:p};return new n(d)},e.exports=s},{"./chain":4,"./chain_context":5,"./operation_names":10,"./operation_packager":11,"./utils":15}],"p-j-s":[function(r,e){function t(r){if(!u.isTypedArray(r))throw new s.InvalidArgumentsError(s.messages.INVALID_TYPED_ARRAY);return new p(r,c.length,h)}function n(r){if(l)throw new s.InvalidOperationError(s.messages.CONSECUTIVE_INITS);r=r||{};var e=navigator.hardwareConcurrency||r.maxWorkers||1,t=r.maxWorkers||e,n=Math.min(t,e);c.init(n);var o={get workers(){return c.length}};u.getter(i,"config",o),u.getter(i,"contextUpdatePackager",new d(c.length)),l=!0}function o(r,e){var t=this;return new Promise(function(n,o){var a=t.contextUpdatePackager.generatePackages(r);c.sendPacks(a,function(t){return t?(e?e(t):o(t),void 0):(f(h,r),e?e():n(),void 0)})})}function a(){if(!l)throw new s.InvalidOperationError(s.messages.TERMINATE_WITHOUT_INIT);c.terminate(),h={},delete i.config,delete i.contextUpdatePackager,l=!1}var i,s=r("./errors"),u=r("./utils"),c=r("./workers"),p=r("./wrapped_typed_array"),d=r("./context_update_packager"),f=r("xtend/mutable"),l=!1,h={};i=e.exports=t,i.init=n,i.terminate=a,i.updateContext=o},{"./context_update_packager":7,"./errors":8,"./utils":15,"./workers":18,"./wrapped_typed_array":19,"xtend/mutable":3}]},{},[]);