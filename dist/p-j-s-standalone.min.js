!function(r){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.pJS=r()}}(function(){return function r(e,t,n){function o(a,s){if(!t[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var p=t[a]={exports:{}};e[a][0].call(p.exports,function(r){var t=e[a][1][r];return o(t?t:r)},p,p.exports,r,e,t,n)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(r,e){var t=arguments[3],n=arguments[4],o=arguments[5],i=JSON.stringify;e.exports=function(r){for(var e,a=Object.keys(o),s=0,u=a.length;u>s;s++){var c=a[s];if(o[c].exports===r){e=c;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var p={},s=0,u=a.length;u>s;s++){var c=a[s];p[c]=c}n[e]=[Function(["require","module","exports"],"("+r+")(self)"),p]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),l={};l[e]=e,n[f]=[Function(["require"],"require("+i(e)+")(self)"),l];var d="("+t+")({"+Object.keys(n).map(function(r){return i(r)+":["+n[r][0]+","+i(n[r][1])+"]"}).join(",")+"},{},["+i(f)+"])",h=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(h.createObjectURL(new Blob([d],{type:"text/javascript"})))}},{}],2:[function(r,e){var t=e.exports={},n=function(r){this.name="InvalidOperationError",this.message=r||"Invalid Operation"};n.prototype=new Error,n.prototype.constructor=n,t.InvalidOperationError=n;var o=function(r){this.name="InvalidArgumentsError",this.message=r||"Invalid Arguments"};o.prototype=new Error,o.prototype.constructor=o,t.InvalidArgumentsError=o,t.messages={CONSECUTIVE_INITS:"You should not recall init if the library is already initialized.",TERMINATE_WITHOUT_INIT:"You should not terminate pjs if it was not initialized before.",PARTITIONER_ARGUMENT_IS_NOT_TYPED_ARRAY:"Expected TypedArray argument.",ZERO_ARRAYS_TO_MERGE:"Zero arrays to merge. Provide at least one.",INVALID_PARTS:"Invalid number of parts.",PART_ALREADY_COLLECTED:"Tried to collect part {0} more than once",INVALID_CODE:"Invalid code argument to package.",INVALID_ELEMENTS:"Invalid number of elements to package.",INVALID_PACKAGE_INDEX:"Package index should be not negative and less than {0}.",INVALID_TYPED_ARRAY:"Invalid argument. It should be of TypedArray.",INVALID_OPERATION:"Invalid pjs operation. Possible values are 'filter', 'map' or 'reduce'.",INVALID_OPERATIONS:"Invalid operation chain sent to JobPackager. Either undefined or empty.",MISSING_SEED:"Missing Seed argument for reduce operation packaging.",MISSING_IDENTITY:"Missing Identity argument for reduce operation packaging.",INVALID_CHAINING_OPERATION:"Can not perform more chaining after reduce operation."}},{}],3:[function(r,e){function t(r){if(!s.isTypedArray(r))throw new a.InvalidArgumentsError(a.messages.INVALID_TYPED_ARRAY);return new c(r,i.config.workers,f)}function n(e){if(p)throw new a.InvalidOperationError(a.messages.CONSECUTIVE_INITS);e=e||{};for(var t=navigator.hardwareConcurrency||1,n=e.maxWorkers||t,o=Math.min(n,t);o--;){var c=u(r("./worker.js"));f.push(c)}var l={get workers(){return f.length}};s.getter(i,"config",l),p=!0}function o(){if(!p)throw new a.InvalidOperationError(a.messages.TERMINATE_WITHOUT_INIT);f.forEach(function(r){r.terminate()}),f=[],delete i.config,p=!1}var i,a=r("./errors"),s=r("./utils"),u=r("webworkify"),c=r("./wrapped_typed_array"),p=!1,f=[];i=e.exports=t,i.init=n,i.terminate=o},{"./errors":2,"./utils":11,"./worker.js":12,"./wrapped_typed_array":14,webworkify:1}],4:[function(r,e){var t=r("./errors"),n=r("./utils"),o=r("./typed_array_partitioner"),i=r("./operation_names");i=Object.keys(i).map(function(r){return i[r]});var a=/^function[^(]*\(([^)]*)\)[^{]*\{([\s\S]*)\}$/,s=e.exports=function(r,e){if(!r)throw new t.InvalidArgumentsError(t.messages.INVALID_PARTS);if(!e)throw new t.InvalidArgumentsError(t.messages.INVALID_ELEMENTS);this.parts=r,this.elements=e};s.prototype.generatePackages=function(r,e){if(!r||!r.length)throw new t.InvalidArgumentsError(t.messages.INVALID_OPERATIONS);var s=r.map(function(r){if(!r.code)throw new t.InvalidArgumentsError(t.messages.INVALID_CODE);if(!r.name||-1===i.indexOf(r.name))throw new t.InvalidArgumentsError(t.messages.INVALID_OPERATION);var e=r.code.toString(),n=e.match(a),o=n[1].split(",").map(function(r){return r.trim()}),s=n[2];return{identity:r.identity,args:o,code:s,name:r.name}}),u=n.getTypedArrayType(this.elements),c=new o(this.parts),p=c.partition(this.elements);return p.map(function(r,t){return{index:t,buffer:r.buffer,operations:s,elementsType:u,ctx:e}})}},{"./errors":2,"./operation_names":5,"./typed_array_partitioner":10,"./utils":11}],5:[function(r,e){e.exports={MAP:"map",FILTER:"filter",REDUCE:"reduce"}},{}],6:[function(r,e){var t=r("./errors"),n=r("./operation_names");n=Object.keys(n).map(function(r){return n[r]}),e.exports=function(r,e,o,i){if(!r||-1===n.indexOf(r))throw new t.InvalidArgumentsError(t.messages.INVALID_OPERATION);if(!e)throw new t.InvalidArgumentsError(t.messages.INVALID_CODE);if("reduce"===r&&void 0===o)throw new t.InvalidArgumentsError(t.messages.MISSING_SEED);if("reduce"===r&&void 0===i)throw new t.InvalidArgumentsError(t.messages.MISSING_IDENTITY);return{name:r,code:e,seed:o,identity:i}}},{"./errors":2,"./operation_names":5}],7:[function(r,e){var t=r("./errors.js"),n=r("./utils.js"),o=e.exports=function(r,e){if(!r)throw new t.InvalidArgumentsError(t.messages.INVALID_PARTS);if(!e)throw new t.InvalidArgumentsError(t.messages.MISSING_CALLBACK);this.cb=e,this.parts=r,this.collected=new Array(r),this.completed=0};o.prototype.onPart=function(r){if(this.collected[r.index])throw new t.InvalidArgumentsError(n.format(t.messages.PART_ALREADY_COLLECTED,r.index));return this.collected[r.index]={value:r.value,newLength:r.newLength},++this.completed===this.parts?this.cb(this.collected):void 0}},{"./errors.js":2,"./utils.js":11}],8:[function(r,e){var t=r("./job_packager"),n=r("./result_collector"),o=r("./typed_array_merger"),i=r("./utils"),a=r("./operation_names"),s=r("./operation_packager"),u=r("./errors"),c={map:function(r,e,t){t(e)},filter:function(r,e,t){t(e)},reduce:function(r,e,t){var n,o=r.context,i=r.operation,a=i.code,s=i.seed;n=o?Array.prototype.slice.call(e).reduce(function(r,e){return a(r,e,o)},s):Array.prototype.slice.call(e).reduce(a,s),t(n)}},p=function(r,e,n,o,i,a){this.packager=new t(e,r),this.source=r,this.parts=e,this.workers=n,this.operation=o,this.context=i,a=a||[],a.push(o),this.operations=a};p.prototype.map=function(r,e){this.__verifyPreviousOperation(),this.__expandContext(e);var t=s(a.MAP,r);return new p(this.source,this.parts,this.workers,t,this.context,this.operations)},p.prototype.filter=function(r,e){this.__verifyPreviousOperation(),this.__expandContext(e);var t=s(a.FILTER,r);return new p(this.source,this.parts,this.workers,t,this.context,this.operations)},p.prototype.reduce=function(r,e,t,n){this.__verifyPreviousOperation(),this.__expandContext(n);var o=s(a.REDUCE,r,e,t);return new p(this.source,this.parts,this.workers,o,this.context,this.operations)},p.prototype.seq=function(r){var e=this,t=this.workers,a=this.source.constructor,s=this.packager.generatePackages(this.operations,this.context),u=new n(this.parts,function(t){var n=t.map(function(r){return new a(r.value).subarray(0,r.newLength)}),i=o(n);return c[e.operation.name](e,i,r)});s.forEach(function(r,e){i.listenOnce(t[e],"message",function(r){u.onPart(r.data)}),t[e].postMessage(r,[r.buffer])})},p.prototype.__verifyPreviousOperation=function(){if("reduce"===this.operation.name)throw new u.InvalidOperationError(u.messages.INVALID_CHAINING_OPERATION)},p.prototype.__expandContext=function(r){if(r){var e=this.context;if(e)for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);else e=r;this.context=e}},e.exports=p},{"./errors":2,"./job_packager":4,"./operation_names":5,"./operation_packager":6,"./result_collector":7,"./typed_array_merger":9,"./utils":11}],9:[function(r,e){var t=r("./errors.js");e.exports=function(r){if(!r.length)throw new t.InvalidArgumentsError(t.messages.ZERO_ARRAYS_TO_MERGE);var e=r[0];if(1===r.length)return e;for(var n=r.reduce(function(r,e){return r+e.length},0),o=new e.constructor(n),i=0,a=0;a<r.length;a++){var s=r[a];o.set(s,i),i+=s.length}return o}},{"./errors.js":2}],10:[function(r,e){var t=r("./utils.js"),n=r("./errors.js"),o=function(r,e,t){var n=r.subarray(e,t);return new r.constructor(n)},i=e.exports=function(r){if(!r)throw new n.InvalidArgumentsError(n.messages.INVALID_PARTS);this.parts=r};i.prototype.constructor=i,i.prototype.partition=function(r){return this.validateTypedArray(r),this.doPartition(r,this)},i.prototype.validateTypedArray=function(r){if(!t.isTypedArray(r)){var e=t.format("Invalid type {0}. {1}",r,n.messages.PARTITIONER_ARGUMENT_IS_NOT_TYPED_ARRAY);throw new n.InvalidArgumentsError(e)}},i.prototype.doPartition=function(r){for(var e=this.parts,t=r.length,n=t/e|0,i=0,a=0,s=new Array(e),u=0;e>u;u++)e-1===u?a=t:a+=n,s[u]=o(r,i,a),i+=n;return s}},{"./errors.js":2,"./utils.js":11}],11:[function(r,e){var t=e.exports={};t.getter=function(r,e,t){Object.defineProperty(r,e,{enumerable:!0,configurable:!0,get:function(){return t}})},t.isTypedArray=function(r){if(!r)return!1;var e=t.getTypedArrayType(r);switch(e){case"Uint8Array":case"Int8Array":case"Uint8ClampedArray":case"Uint16Array":case"Int16Array":case"Uint32Array":case"Int32Array":case"Float32Array":case"Float64Array":return!0;default:return!1}},t.getTypedArrayConstructorType=function(r){var e=r.toString();return e.substring("function ".length,e.length-"() { [native code] }".length)},t.getTypedArrayType=function(r){var e=r.toString();return e.substring("[object ".length,e.length-1)},t.format=function(r){for(var e=Array.prototype.slice.call(arguments,1),t=r,n=0;n<e.length;n++)t=t.replace("{"+n+"}",e[n]);return t},t.listenOnce=function(r,e,t){r.addEventListener(e,function n(r){return r.target.removeEventListener(e,n),t(r)})}},{}],12:[function(r,e){var t=r("./worker_core");e.exports=function(r){r.addEventListener("message",function(e){var n=t(e);r.postMessage(n.message,n.transferables)})}},{"./worker_core":13}],13:[function(r,e){function t(r,e){switch(r){case"Uint8Array":return new Uint8Array(e);case"Uint8ClampedArray":return new Uint8ClampedArray(e);case"Uint16Array":return new Uint16Array(e);case"Uint32Array":return new Uint32Array(e);case"Int8Array":return new Int8Array(e);case"Int16Array":return new Int16Array(e);case"Int32Array":return new Int32Array(e);case"Float32Array":return new Float32Array(e);case"Float64Array":return new Float64Array(e)}}function n(){return"function"==typeof Map?function(){return new Map}:function(){return Object.create(null)}}function o(r,e){return 1===r.length?new Function(r[0],e):2===r.length?new Function(r[0],r[1],e):3===r.length?new Function(r[0],r[1],r[2],e):void 0}var i=n(),a=i(),s={map:function(r,e,t,n){for(var o=0;e>o;o+=1)r[o]=t(r[o],n);return e},filter:function(r,e,t,n){for(var o=0,i=0;e>o;o+=1){var a=r[o];t(a,n)&&(r[i++]=a)}return i},reduce:function(r,e,t,n,o){console.log("ww - reduce");for(var i=0,a=o;e>i;i+=1){var s=r[i];a=t(a,s,n)}return r[0]=a,1}};e.exports=function(r){for(var e=r.data,n=e.ctx,i=e.operations,u=i.length,c=t(e.elementsType,e.buffer),p=c.length,f=0;u>f;f+=1){var l=i[f],d=l.identity,h=l.args,g=l.code,y=h.join(",")+g,I=a[y];I||(I=o(h,g),a[y]=I),p=s[l.name](c,p,I,n,d)}return{message:{index:e.index,value:c.buffer,newLength:p},transferables:[c.buffer]}}},{}],14:[function(r,e){var t=r("./operation_names"),n=r("./skeleton"),o=r("./operation_packager"),i=function(r,e,t){this.source=r,this.parts=e,this.workers=t};i.prototype.map=function(r,e){return this.__operation(t.MAP,r,e)},i.prototype.filter=function(r,e){return this.__operation(t.FILTER,r,e)},i.prototype.reduce=function(r,e,n,o){return this.__operation(t.REDUCE,r,o,e,n)},i.prototype.__operation=function(r,e,t,i,a){var s=o(r,e,i,a);return new n(this.source,this.parts,this.workers,s,t)},e.exports=i},{"./operation_names":5,"./operation_packager":6,"./skeleton":8}]},{},[3])(3)});