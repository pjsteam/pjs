!function(r){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.pJS=r()}}(function(){return function r(e,t,n){function o(s,i){if(!t[s]){if(!e[s]){var u="function"==typeof require&&require;if(!i&&u)return u(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=t[s]={exports:{}};e[s][0].call(f.exports,function(r){var t=e[s][1][r];return o(t?t:r)},f,f.exports,r,e,t,n)}return t[s].exports}for(var a="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(r,e){var t=arguments[3],n=arguments[4],o=arguments[5],a=JSON.stringify;e.exports=function(r){for(var e,s=Object.keys(o),i=0,u=s.length;u>i;i++){var c=s[i];if(o[c].exports===r){e=c;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var f={},i=0,u=s.length;u>i;i++){var c=s[i];f[c]=c}n[e]=[Function(["require","module","exports"],"("+r+")(self)"),f]}var l=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[e]=e,n[l]=[Function(["require"],"require("+a(e)+")(self)"),p];var d="("+t+")({"+Object.keys(n).map(function(r){return a(r)+":["+n[r][0]+","+a(n[r][1])+"]"}).join(",")+"},{},["+a(l)+"])",y=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(y.createObjectURL(new Blob([d],{type:"text/javascript"})))}},{}],2:[function(r,e){var t=e.exports={},n=function(r){this.name="InvalidOperationError",this.message=r||"Invalid Operation"};n.prototype=new Error,n.prototype.constructor=n,t.InvalidOperationError=n;var o=function(r){this.name="InvalidArgumentsError",this.message=r||"Invalid Arguments"};o.prototype=new Error,o.prototype.constructor=o,t.InvalidArgumentsError=o,t.messages={CONSECUTIVE_INITS:"You should not recall init if the library is already initialized.",TERMINATE_WITHOUT_INIT:"You should not terminate pjs if it was not initialized before.",PARTITIONER_ARGUMENT_IS_NOT_TYPED_ARRAY:"Expected TypedArray argument.",ZERO_ARRAYS_TO_MERGE:"Zero arrays to merge. Provide at least one.",INVALID_PARTS:"Invalid number of parts.",PART_ALREADY_COLLECTED:"Tried to collect part {0} more than once",INVALID_CODE:"Invalid code argument to package.",INVALID_ELEMENTS:"Invalid number of elements to package.",INVALID_PACKAGE_INDEX:"Package index should be not negative and less than {0}.",INVALID_TYPED_ARRAY:"Invalid argument. It should be of TypedArray"}},{}],3:[function(r,e){function t(r){if(!i.isTypedArray(r))throw new s.InvalidArgumentsError(s.messages.INVALID_TYPED_ARRAY);return new y(r,a.config.workers)}function n(e){if(p)throw new s.InvalidOperationError(s.messages.CONSECUTIVE_INITS);e=e||{};for(var t=navigator.hardwareConcurrency||1,n=e.maxWorkers||t,o=Math.min(n,t);o--;){var u=l(r("./worker.js"));d.push(u)}var c={get workers(){return d.length}};i.getter(a,"config",c),p=!0}function o(){if(!p)throw new s.InvalidOperationError(s.messages.TERMINATE_WITHOUT_INIT);d.forEach(function(r){r.terminate()}),d=[],delete a.config,p=!1}var a,s=r("./errors.js"),i=r("./utils.js"),u=r("./job_packager.js"),c=r("./result_collector.js"),f=r("./typed_array_merger.js"),l=r("webworkify"),p=!1,d=[],y=function(r,e){this.source=r,this.parts=e};y.prototype.map=function(r,e){var t=new u(this.parts,r,this.source),n=t.generatePackages(),o=this.source.constructor,a=new c(this.parts,function(r){var t=r.map(function(r){return new o(r)}),n=f(t);return e(n)});n.forEach(function(r,e){i.listenOnce(d[e],"message",function(r){a.onPart(r.data)}),d[e].postMessage(r,[r.buffer])})},a=e.exports=t,a.init=n,a.terminate=o},{"./errors.js":2,"./job_packager.js":4,"./result_collector.js":5,"./typed_array_merger.js":6,"./utils.js":8,"./worker.js":9,webworkify:1}],4:[function(r,e){var t=r("./errors.js"),n=r("./utils.js"),o=r("./typed_array_partitioner.js"),a=/^function[^(]*\(([^)]*)\)[^{]*\{([\s\S]*)\}$/,s=e.exports=function(r,e,n){if(!r)throw new t.InvalidArgumentsError(t.messages.INVALID_PARTS);if(!e)throw new t.InvalidArgumentsError(t.messages.INVALID_CODE);if(!n)throw new t.InvalidArgumentsError(t.messages.INVALID_ELEMENTS);this.parts=r,this.code=e,this.elements=n};s.prototype.generatePackages=function(){var r=this.code.toString(),e=r.match(a),t=e[1].split(",")[0].trim(),s=e[2],i=n.getTypedArrayType(this.elements),u=new o(this.parts),c=u.partition(this.elements);return c.map(function(r,e){return{index:e,arg:t,code:s,buffer:r.buffer,elementsType:i}})}},{"./errors.js":2,"./typed_array_partitioner.js":7,"./utils.js":8}],5:[function(r,e){var t=r("./errors.js"),n=r("./utils.js"),o=e.exports=function(r,e){if(!r)throw new t.InvalidArgumentsError(t.messages.INVALID_PARTS);if(!e)throw new t.InvalidArgumentsError(t.messages.MISSING_CALLBACK);this.cb=e,this.parts=r,this.collected=new Array(r),this.completed=0};o.prototype.onPart=function(r){if(this.collected[r.index])throw new t.InvalidArgumentsError(n.format(t.messages.PART_ALREADY_COLLECTED,r.index));return this.collected[r.index]=r.value,++this.completed===this.parts?this.cb(this.collected):void 0}},{"./errors.js":2,"./utils.js":8}],6:[function(r,e){var t=r("./errors.js");e.exports=function(r){if(!r.length)throw new t.InvalidArgumentsError(t.messages.ZERO_ARRAYS_TO_MERGE);var e=r[0];if(1===r.length)return e;for(var n=r.reduce(function(r,e){return r+e.length},0),o=new e.constructor(n),a=0,s=0;s<r.length;s++){var i=r[s];o.set(i,a),a+=i.length}return o}},{"./errors.js":2}],7:[function(r,e){var t=r("./utils.js"),n=r("./errors.js"),o=function(r,e,t){var n=r.subarray(e,t);return new r.constructor(n)},a=e.exports=function(r){if(!r)throw new n.InvalidArgumentsError(n.messages.INVALID_PARTS);this.parts=r};a.prototype.constructor=a,a.prototype.partition=function(r){return this.validateTypedArray(r),this.doPartition(r,this)},a.prototype.validateTypedArray=function(r){if(!t.isTypedArray(r)){var e=t.format("Invalid type {0}. {1}",r,n.messages.PARTITIONER_ARGUMENT_IS_NOT_TYPED_ARRAY);throw new n.InvalidArgumentsError(e)}},a.prototype.doPartition=function(r){for(var e=this.parts,t=r.length,n=t/e|0,a=0,s=0,i=new Array(e),u=0;e>u;u++)e-1===u?s=t:s+=n,i[u]=o(r,a,s),a+=n;return i}},{"./errors.js":2,"./utils.js":8}],8:[function(r,e){var t=e.exports={};t.getter=function(r,e,t){Object.defineProperty(r,e,{enumerable:!0,configurable:!0,get:function(){return t}})},t.isTypedArray=function(r){if(!r)return!1;var e=t.getTypedArrayType(r);switch(e){case"Uint8Array":case"Int8Array":case"Uint8ClampedArray":case"Uint16Array":case"Int16Array":case"Uint32Array":case"Int32Array":case"Float32Array":case"Float64Array":return!0;default:return!1}},t.getTypedArrayType=function(r){var e=r.toString();return e.substring("[object ".length,e.length-1)},t.format=function(r){for(var e=Array.prototype.slice.call(arguments,1),t=r,n=0;n<e.length;n++)t=t.replace("{"+n+"}",e[n]);return t},t.listenOnce=function(r,e,t){r.addEventListener(e,function n(r){return r.target.removeEventListener(e,n),t(r)})}},{}],9:[function(r,e){var t=r("./worker_core");e.exports=function(r){r.addEventListener("message",function(e){var n=t(e);r.postMessage(n.message,n.transferables)})}},{"./worker_core":10}],10:[function(r,e){function t(r,e){switch(r){case"Uint8Array":return new Uint8Array(e);case"Uint8ClampedArray":return new Uint8ClampedArray(e);case"Uint16Array":return new Uint16Array(e);case"Uint32Array":return new Uint32Array(e);case"Int8Array":return new Int8Array(e);case"Int16Array":return new Int16Array(e);case"Int32Array":return new Int32Array(e);case"Float32Array":return new Float32Array(e);case"Float64Array":return new Float64Array(e)}}var n=new Map;e.exports=function(r){var e=r.data,o=e.arg,a=e.code,s=o+a,i=n[s];i||(i=new Function(o,a),n[s]=i);for(var u=t(e.elementsType,e.buffer),c=u.length;c--;)u[c]=i(u[c]);return{message:{index:e.index,value:u.buffer},transferables:[u.buffer]}}},{}]},{},[3])(3)});